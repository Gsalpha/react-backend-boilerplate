{"version":3,"sources":["stores/ducks/loading.ts","utils/history.ts","stores/create.ts","App.tsx","index.tsx","components/Dynamic/index.tsx","stores/ducks/global.type.ts","utils/axios.ts","config/prefix.ts","services/global.ts","stores/ducks/global.ts","utils/index.ts"],"names":["initialState","login","auth","setLoadingAction","_ref","type","payload","scope","loading","__webpack_exports__","state","arguments","length","undefined","action","Object","_Users_yuzhe_FE_react_backend_boilerplate_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__","_Users_yuzhe_FE_react_backend_boilerplate_node_modules_babel_runtime_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_0__","history","createBrowserHistory","composeEnhancers","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","rootReducer","combineReducers","router","connectRouter","global","globalReducer","loadingReducer","middlewares","routerMiddleware","thunkMiddleware","store","createStore","applyMiddleware","apply","Login","Dynamic","Promise","all","__webpack_require__","e","then","bind","Basic","hot","react_default","a","createElement","es","esm","react_router","component","path","exact","ReactDOM","render","src_App","document","getElementById","react__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_0___default","n","nprogress__WEBPACK_IMPORTED_MODULE_1__","nprogress__WEBPACK_IMPORTED_MODULE_1___default","react_loadable__WEBPACK_IMPORTED_MODULE_2__","react_loadable__WEBPACK_IMPORTED_MODULE_2___default","Loading","useEffect","nprogress","start","done","Fragment","loader","Loadable","actionTypes","axios","Axios","create","baseURL","process","timeout","withCredentials","interceptors","response","use","res","error","data","message","reject","Prefix","request","url","method","loginSucAction","LOGIN_SUC","loginFailAction","LOGIN_FAIL","authFailAction","AUTH_FAIL","loginAction","asyncToGenerator","regenerator_default","mark","_callee","dispatch","_ref2","token","wrap","_context","prev","next","sent","localStorage","setItem","replace","t0","notification_default","description","stop","_x","this","authAction","_ref3","_callee2","_ref4","_ref4$data","username","routes","_context2","isLogined","location","href","indexOf","AUTH_SUC","_x2","logoutAction","LOGOUT","getItem","objectSpread","d"],"mappings":"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","file":"static/js/main.45e40ce6.chunk.js","sourcesContent":["import { Prefix } from '@/config/prefix'\n\nexport interface ISetLoadingPayload {\n    scope: Prefix\n    loading: boolean\n}\n\ntype TLoadingState = { [O in Prefix]: boolean }\n\nconst initialState: TLoadingState = {\n    login: false,\n    auth: true\n}\n\nexport const setLoadingAction = ({ scope, loading }: ISetLoadingPayload) => ({\n    type: 'SET_LOADING',\n    payload: { scope, loading }\n})\n\nexport default (\n    state = initialState,\n    action: ReturnType<typeof setLoadingAction>\n) => {\n    if (action.type === 'SET_LOADING') {\n        return {\n            ...state,\n            [action.payload.scope]: action.payload.loading\n        }\n    }\n    return state\n}\n","import { createBrowserHistory } from 'history'\n\nconst history = createBrowserHistory()\nexport default history\n","import { createStore, applyMiddleware, compose, combineReducers } from 'redux'\nimport thunkMiddleware from 'redux-thunk'\nimport logMiddleware from 'redux-logger'\nimport globalReducer from './ducks/global'\nimport loadingReducer from './ducks/loading'\nimport { connectRouter, routerMiddleware } from 'connected-react-router'\nimport history from '@/utils/history'\n\nconst composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose\nconst rootReducer = combineReducers({\n    router: connectRouter(history),\n    global: globalReducer,\n    loading: loadingReducer\n})\n\nexport type AppState = ReturnType<typeof rootReducer>\nconst middlewares = [routerMiddleware(history), thunkMiddleware]\nif (process.env.NODE_ENV === 'development') {\n    middlewares.push(logMiddleware)\n}\nconst store = createStore(\n    rootReducer,\n    {},\n    composeEnhancers(applyMiddleware(...middlewares))\n)\n\nexport default store\n","import React from 'react'\nimport { hot } from 'react-hot-loader/root'\nimport Dynamic from '@/components/Dynamic'\nimport { Route, Switch } from 'react-router-dom'\nimport { ConnectedRouter } from 'connected-react-router'\n\nimport { Provider } from 'react-redux'\nimport store from '@/stores/create'\nimport history from '@/utils/history'\n\nconst Login = Dynamic(() =>\n    import(/* webpackChunkName:\"login\" */ '@/pages/login')\n)\n\nconst Basic = Dynamic(() =>\n    import(/*webpackChunkName:\"basic\"*/ '@/layouts/baisc')\n)\n\nfunction App() {\n    return (\n        <Provider store={store}>\n            <ConnectedRouter history={history}>\n                <Switch>\n                    <Route component={Login} path=\"/login\" exact />\n                    <Route component={Basic} path=\"/\" />\n                </Switch>\n            </ConnectedRouter>\n        </Provider>\n    )\n}\n\nexport default hot(App)\n","import 'react-hot-loader'\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport '@/assets/styles/_reset.scss'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n","import React, { useEffect, FunctionComponent } from 'react'\nimport nprogress from 'nprogress'\nimport Loadable, { LoadingComponentProps } from 'react-loadable'\n\nconst Loading: FunctionComponent<LoadingComponentProps> = () => {\n    useEffect((): any => {\n        nprogress.start()\n        return nprogress.done\n    }, [])\n    return <></>\n}\n\nexport default (loader: any) =>\n    Loadable({\n        loader,\n        loading: Loading\n    })\n","export interface IGlobalState {\n    token: string\n    username: string\n    routes: string[]\n}\n\nexport interface ILoginPayload {\n    username: string\n    password: string\n}\n\nexport interface ILoginSucPayload {\n    token: string\n}\n\nexport interface IErrorPayload {\n    error: string\n}\n\nexport interface IAuthSucPayload {\n    username: string\n    routes: string[]\n}\n\nexport enum actionTypes {\n    LOGIN_SUC = 'global/login-suc',\n    LOGIN_FAIL = 'global/login-fail',\n    AUTH_SUC = 'global/auth-suc',\n    AUTH_FAIL = 'global/auth-fail',\n    LOGOUT = 'globa/logout'\n}\n\nexport interface ILoginSucAction {\n    type: actionTypes.LOGIN_SUC\n    payload: ILoginSucPayload\n}\n\nexport interface ILoginFailAction {\n    type: actionTypes.LOGIN_FAIL\n    payload: IErrorPayload\n}\n\nexport interface IAuthSucAction {\n    type: actionTypes.AUTH_SUC\n    payload: IAuthSucPayload\n}\n\nexport interface IAuthFailAction {\n    type: actionTypes.AUTH_FAIL\n    payload: IErrorPayload\n}\n\nexport interface ILogoutSucAction {\n    type: actionTypes.LOGOUT\n}\n\nexport type AllActions =\n    | ILoginSucAction\n    | ILoginFailAction\n    | IAuthSucAction\n    | IAuthFailAction\n    | ILogoutSucAction\n","import Axios from 'axios'\n\nconst axios = Axios.create({\n    baseURL: process.env.REACT_APP_FETCH_URL,\n    timeout: 10000,\n    withCredentials: true\n})\naxios.interceptors.response.use(\n    res => res,\n    error => {\n        const { response } = error\n        if (!response || !response.data || !response.data.message) {\n            return Promise.reject({ message: '未知错误' })\n        }\n        return Promise.reject({ message: response.data.message })\n    }\n)\nexport default axios\n","export enum Prefix {\n    login = 'login',\n    auth = 'auth'\n}\n","import axios from '@/utils/axios'\nimport {\n    IAuthSucPayload,\n    ILoginPayload,\n    ILoginSucPayload\n} from '@/stores/ducks/global.type'\n\nexport const login = (payload: ILoginPayload) =>\n    axios.request<ILoginSucPayload>({\n        url: '/login',\n        method: 'post',\n        data: payload\n    })\n\nexport const auth = () =>\n    axios.request<IAuthSucPayload>({\n        url: '/auth'\n    })\n","import {\n    actionTypes,\n    AllActions,\n    IAuthFailAction,\n    IAuthSucAction,\n    IAuthSucPayload,\n    IErrorPayload,\n    IGlobalState,\n    ILoginPayload,\n    ILoginSucAction,\n    ILoginSucPayload,\n    ILogoutSucAction\n} from '@/stores/ducks/global.type'\nimport { ThunkAction } from 'redux-thunk'\nimport { Action } from 'redux'\nimport { setLoadingAction } from '@/stores/ducks/loading'\nimport { auth, login } from '@/services/global'\nimport { notification } from 'antd'\nimport { AppState } from '@/stores/create'\nimport { Prefix } from '@/config/prefix'\nimport { replace } from 'connected-react-router'\nimport { isLogined } from '@/utils'\n\n// Action Creators\nconst loginSucAction = (payload: ILoginSucPayload): ILoginSucAction => ({\n    type: actionTypes.LOGIN_SUC,\n    payload\n})\n\nconst logoutSucAction = (): ILogoutSucAction => ({\n    type: actionTypes.LOGOUT\n})\n\nconst loginFailAction = (payload: IErrorPayload) => ({\n    type: actionTypes.LOGIN_FAIL,\n    payload\n})\n\nconst authSucAction = (payload: IAuthSucPayload): IAuthSucAction => ({\n    type: actionTypes.AUTH_SUC,\n    payload\n})\n\nconst authFailAction = (payload: IErrorPayload): IAuthFailAction => ({\n    type: actionTypes.AUTH_FAIL,\n    payload\n})\n\n// Side effects\nexport const loginAction = (\n    payload: ILoginPayload\n): ThunkAction<void, AppState, null, Action<string>> => async dispatch => {\n    dispatch(\n        setLoadingAction({\n            scope: Prefix.login,\n            loading: true\n        })\n    )\n    try {\n        const {\n            data: { token }\n        } = await login(payload)\n        localStorage.setItem('token', token)\n        dispatch(loginSucAction({ token }))\n        dispatch(\n            setLoadingAction({\n                scope: Prefix.login,\n                loading: false\n            })\n        )\n        dispatch(replace('/'))\n        // window.location.replace('/')\n    } catch (e) {\n        dispatch(\n            setLoadingAction({\n                scope: Prefix.login,\n                loading: false\n            })\n        )\n        dispatch(loginFailAction(e))\n        notification.error({\n            message: '登录失败',\n            description: e.message\n        })\n    }\n}\n\nexport const authAction = (): ThunkAction<\n    void,\n    AppState,\n    null,\n    Action<string>\n> => async dispatch => {\n    if (!isLogined()) {\n        if (window.location.href.indexOf('login') === -1) {\n            dispatch(replace('/login'))\n        } else {\n            dispatch(\n                setLoadingAction({\n                    scope: Prefix.auth,\n                    loading: false\n                })\n            )\n        }\n    } else {\n        dispatch(\n            setLoadingAction({\n                scope: Prefix.auth,\n                loading: true\n            })\n        )\n        try {\n            const {\n                data: { username, routes }\n            } = await auth()\n            dispatch(\n                authSucAction({\n                    username,\n                    routes\n                })\n            )\n            dispatch(\n                setLoadingAction({\n                    scope: Prefix.auth,\n                    loading: false\n                })\n            )\n            if (window.location.href.indexOf('login') > -1) {\n                dispatch(replace('/'))\n            }\n        } catch (e) {\n            dispatch(\n                setLoadingAction({\n                    scope: Prefix.auth,\n                    loading: false\n                })\n            )\n            localStorage.setItem('token', '')\n            if (window.location.href.indexOf('login') === -1) {\n                dispatch(replace('/login'))\n            }\n            dispatch(authFailAction(e))\n            notification.error({\n                message: '获取基本信息',\n                description: e.message\n            })\n        }\n    }\n}\n\nexport const logoutAction = (): ThunkAction<\n    void,\n    AppState,\n    null,\n    Action<string>\n> => dispatch => {\n    dispatch(logoutSucAction())\n    localStorage.setItem('token', '')\n    dispatch(replace('/login'))\n}\n// reducers\nconst initialState: IGlobalState = {\n    token: localStorage.getItem('token') || '',\n    username: '',\n    routes: []\n}\n\nexport default (state = initialState, action: AllActions) => {\n    switch (action.type) {\n        case actionTypes.LOGIN_SUC:\n            return { ...state, token: action.payload.token }\n        case actionTypes.LOGIN_FAIL:\n        case actionTypes.LOGOUT:\n        case actionTypes.AUTH_FAIL:\n            return { ...state, token: '', username: '', routes: [] }\n        case actionTypes.AUTH_SUC:\n            return { ...state, ...action.payload }\n        default:\n            return state\n    }\n}\n","export const isLogined = (): boolean => !!localStorage.getItem('token')\n"],"sourceRoot":""}